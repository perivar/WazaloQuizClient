jQuery(document).ready(function($){function detectIE(){var e=window.navigator.userAgent;return e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0}function ieFix(e){$(e).find("#waz_qc_back_container").css("backface-visibility","visible"),$(e).find("#waz_qc_back_container").css("transform","none"),$(e).find("#waz_qc_back_container").hide()}function loadQuizzes(){$(".waz_qc_quiz").each(function(index){var quizId=getQuizId(this);quizId&&(quizzes[quizId]=eval("quizData_"+quizId),quizzes[quizId].selector=this,defaultImg=quizzes[quizId].default_img)}),$.each(quizzes,function(e){$.each(quizzes[e].questions,function(i){quizzes[e].questions[i].answers=quizzes[e].questions[i].answers.filter(function(e){return""!==e.answer||""!==e.img}),quizzes[e].questions[i].hasOwnProperty("answers")&&0!==quizzes[e].questions[i].answers.length||quizzes[e].questions.splice(i)})}),$.each(quizzes,function(e){"on"==quizzes[e].quiz_settings.shuffle_questions&&(quizzes[e].questions=shuffleArray(quizzes[e].questions))})}function preloadImages(){$.each(quizzes,function(e){quizzes[e].questions[0]&&lazyLoadQuestion(quizzes[e].questions[0])})}function lazyLoadResults(e){e.hasOwnProperty("quiz_results")&&$.each(e.quiz_results,function(i){e.quiz_results[i].hasOwnProperty("img")&&lazyLoadImage(e.quiz_results[i].img)})}function lazyLoadImage(e){if(""!==e&&void 0!==e&&"string"==typeof e){(new Image).src=e}}function lazyLoadQuestion(e){e.hasOwnProperty("img")&&lazyLoadImage(e.img),e.hasOwnProperty("answers")&&$.each(e.answers,function(i){e.answers[i].hasOwnProperty("img")&&lazyLoadImage(e.answers[i].img)})}function getQuizId(e){var i=$(e).attr("id");return!!i&&i.replace(/\D+/g,"")}function showQuestion(e){if(e.questionCurrentIndex<e.questionCount){$(e.selector).find(".waz_qc_question_count").html(e.questionCurrentIndex+1+"/"+e.questionCount);var i=e.questions[e.questionCurrentIndex].question;$(e.selector).find("#waz_qc_question").html(i),$(e.selector).find("#waz_qc_question_back").html(i);var n=e.questions[e.questionCurrentIndex].img;$(e.selector).find("#waz_qc_answer_container").find(".waz_qc_quiz_question_img").attr("src",n),$(e.selector).find("#waz_qc_back_container").find(".waz_qc_quiz_question_img").attr("src",n),$(e.selector).find("#waz_qc_answer_container").data("id",e.questions[e.questionCurrentIndex].id);var s;"mc"==e.quiz_settings.quiz_type&&(s=e.questions[e.questionCurrentIndex].answers[0]);var t=shuffleArray(e.questions[e.questionCurrentIndex].answers);e.questionCurrentIndex+1<e.questionCount?lazyLoadQuestion(e.questions[e.questionCurrentIndex+1]):lazyLoadResults(e),$(e.selector).find(".waz_qc_answer_div").hide();for(var r=0;r<t.length;r++)""===t[r].img&&""===t[r].answer||("mc"==e.quiz_settings.quiz_type&&t[r].answer==s.answer&&t[r].img==s.img&&(e.currentAnswer=$(e.selector).find(".waz_qc_answer_div").eq(r).attr("data-question")),"pt"==e.quiz_settings.quiz_type&&$(e.selector).find(".waz_qc_answer_div").eq(r).data("results",t[r].results),$(e.selector).find(".waz_qc_answer_div").eq(r).find(".waz_qc_quiz_answer_img").attr("src",t[r].img),$(e.selector).find(".waz_qc_answer_div").eq(r).find(".waz_qc_answer_span").html(svgSquare+t[r].answer),$(e.selector).find(".waz_qc_answer_div").eq(r).data("id",t[r].id),$(e.selector).find(".waz_qc_answer_div").eq(r).show());$(e.selector).find("#waz_qc_answer_container").waitForImages(function(){maybeAddQuarterClass(e.selector),scaleFlipBoxQuestion(e.selector)}),e.questionCurrentIndex=e.questionCurrentIndex+1}else endTest(e)}function maxHeightOfElementSet(e){var i=0;return $.each(e,function(n){e.eq(n).outerHeight()>i&&(i=e.eq(n).outerHeight())}),i}function scaleFlipBoxQuestion(e){var i=$(e).find("#waz_qc_question").outerHeight(!0);i+=$(e).find(".waz_qc_quiz_question_img").outerHeight(!0);var n=0,s=0;$(e).find(".waz_qc_answer_div:visible").eq(0).hasClass("waz-qc-twoup")?(s=maxHeightOfElementSet($(e).find(".waz_qc_answer_div:visible")),n=$(e).find(".waz_qc_answer_div:visible").length,n=Math.floor(n/2)+n%2,i+=s*n):$(e).find(".waz_qc_answer_div:visible").eq(0).hasClass("waz-qc-threeup")?(s=maxHeightOfElementSet($(e).find(".waz_qc_answer_div:visible")),n=$(e).find(".waz_qc_answer_div:visible").length,n/=3,i+=s*n):$(e).find(".waz_qc_answer_div:visible").each(function(){i+=$(this).outerHeight(!0)}),200>i&&(i=200),$(e).find(".waz_qc_quiz_div, #waz_qc_answer_container, #waz_qc_back_container").outerHeight(i)}function scaleFlipBoxBack(e){var i=0;$(e).find("#waz_qc_back_container").children().each(function(){$(this).is(":visible")&&(i+=$(this).outerHeight(!0))}),i+=35,400>i&&(i=400),$(e).find(".waz_qc_quiz_div, #waz_qc_answer_container, #waz_qc_back_container").height(i)}function maybeAddQuarterClass(e){$(e).find(".waz_qc_answer_div").height("auto"),$(e).find(".waz_qc_answer_div").removeClass("waz-qc-twoup waz-qc-threeup"),$(e).find(".waz_qc_quiz_answer_img").css("marginBottom",0);var i=!0,n=0;if($(e).find(".waz_qc_answer_div:visible").each(function(){return n++,""!==$(this).find(".waz_qc_quiz_answer_img").attr("src")&&i?void 0:(i=!1,!1)}),i){var s="waz-qc-twoup";n%3==0&&0===$(e).find(".waz_qc_mobile_check:visible").length&&(s="waz-qc-threeup"),$(e).find(".waz_qc_answer_div").addClass(s);var t=maxHeightOfElementSet($(e).find(".waz_qc_quiz_answer_img:visible"));t>200&&(t=200),$(e).find(".waz_qc_quiz_answer_img:visible").each(function(){$(this).css("marginBottom",t-$(this).height()+10+"px")});var r=maxHeightOfElementSet($(e).find(".waz_qc_answer_div:visible"));return $(e).find(".waz_qc_answer_div:visible").outerHeight(r),!0}return!1}function setResult(e){var i="undefined";if("pt"==e.quiz_settings.quiz_type){var n=-1,s=[];$.each(e.quiz_results,function(e,i){i.hasOwnProperty("score")&&i.score>n&&(n=i.score)}),$.each(e.quiz_results,function(e,i){i.hasOwnProperty("score")&&i.score==n&&s.push(i)}),0===s.length&&(s=e.quiz_results),$(e.selector).find(".waz_qc_score_text").hide(),i=s[Math.floor(Math.random()*s.length)]}else{for(var t=0;"undefined"==i;)e.quiz_results[t].min<=e.score&&e.quiz_results[t].max>=e.score?i=e.quiz_results[t]:t==e.quiz_results.length?i="error":t++;var r=scoreString.replace("{{SCORE_CORRECT}}",e.score);r=r.replace("{{SCORE_TOTAL}}",e.questionCount),$(e.selector).find(".waz_qc_score_text").html(r)}return $(e.selector).find(".waz_qc_score_title").html(i.title),$(e.selector).find(".waz_qc_score_img").attr("src",i.img),$(e.selector).find(".waz_qc_score_desc").html(i.desc),i.hasOwnProperty("id")?addResult(e.ajaxurl,e.nonce,e.quiz_id,i.id):addResult(e.ajaxurl,e.nonce,e.quiz_id,e.score),"pt"==e.quiz_settings.quiz_type?i.title:i.title?e.score+"/"+e.questionCount+": "+i.title:e.score+"/"+e.questionCount}function showResponses(e){for(var i,n=0;n<e.questions.length;n++)i="",i+=e.responses[n].isCorrect?"<div class='waz_qc_question_response_item correct-answer'>":"<div class='waz_qc_question_response_item wrong-answer'>",i+="<h3 class='waz_qc_question_response_question'>"+(n+1)+". "+e.questions[n].question+"</h3>",i+="<img class='waz_qc_quiz_question_img' src='"+e.questions[n].img+"'>",i+="<p class='waz_qc_question_response_response'><span class='waz_qc_bold'>"+e.your_answer_string+" </span>"+e.responses[n].answer+"</p>",i+="<p class='waz_qc_question_response_correct_answer'><span class='waz_qc_bold'>"+e.correct_answer_string+"</span>"+e.responses[n].correctAnswer+"</p>",i+="</div>",$(e.selector).find(".waz_qc_insert_response_above").before(i),$(e.selector).find(".waz_qc_your_answer_container").show()}function endTest(e){addActivity(e.ajaxurl,e.nonce,e.quiz_id,"completions"),$(e.selector).find(".waz_qc_quiz_footer").hide(),$(e.selector).find(".waz_qc_quiz_div").hide(),"on"==e.optin_settings.capture_emails?showOptins(e):showSharingAndResultScreen(e,setResult(e))}function showOptins(e){var i=setResult(e);$(e.selector).find(".waz_qc_optin_input").tooltipster({trigger:"custom",maxWidth:240,theme:["tooltipster-borderless","tooltipster-quiz"]}).tooltipster("close"),$(e.selector).find(".waz_qc_optin_container").show(),$(e.selector).find(".waz_qc_optin_input").first().focus(),$(e.selector).find(".waz_qc_skip_email_button").click(function(){$(e.selector).find(".waz_qc_optin_container").hide(),$(e.selector).find(".waz_qc_optin_input").tooltipster("close"),showSharingAndResultScreen(e,i)}),$(e.selector).find(".waz_qc_submit_email_button").click(function(){var n=$(e.selector).find("#waz_qc_email_input").val(),s=$(e.selector).find("#waz_qc_name_input").val(),t=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,r=t.test(n),a=""!==s||0===$(e.selector).find("#waz_qc_name_input").length;$(e.selector).find(".waz_qc_optin_input").removeClass("waz_qc_invalid"),e.selector.offsetWidth=e.selector.offsetWidth,r&&a?($(document).unbind("keypress"),$(e.selector).find(".waz_qc_optin_input").tooltipster("close"),e.user={name:s,user_email:n},addToMailingList(e.ajaxurl,e.quiz_id,e.nonce,n,s,i),$(e.selector).find(".waz_qc_optin_container").hide(),showSharingAndResultScreen(e,i)):(r?($(e.selector).find("#waz_qc_email_input").tooltipster("close"),$(e.selector).find("#waz_qc_email_input").removeClass("waz_qc_invalid")):($(e.selector).find("#waz_qc_email_input").tooltipster("open"),$(e.selector).find("#waz_qc_email_input").addClass("waz_qc_invalid")),a?($(e.selector).find("#waz_qc_name_input").tooltipster("close"),$(e.selector).find("#waz_qc_name_input").removeClass("waz_qc_invalid")):($(e.selector).find("#waz_qc_name_input").tooltipster("open"),$(e.selector).find("#waz_qc_name_input").addClass("waz_qc_invalid")))}),0===$(e.selector).find(".waz_qc_skip_email_button").length&&0===$(e.selector).find(".waz_qc_submit_email_button").length?showSharingAndResultScreen(e,i):$(document).keypress(function(i){return 13==i.which?($(e.selector).find(".waz_qc_submit_email_button").click(),!1):void 0})}function addToMailingList(e,i,n,s,t,r){return-1!==optins.indexOf(i)?(console.log("already opted in for this quiz!"),!1):(optins.push(i),void $.ajax({url:e,type:"POST",data:{action:"waz_qc_add_to_mailing_list",nonce:n,quiz_id:i,email:s,name:t,result:r}}).done(function(e){console.log(e)}))}function addActivity(e,i,n,s){if("shares"==s){if(-1!==shared.indexOf(n))return console.log("already shared this quiz!"),!1;shared.push(n)}else if("completions"==s){if(-1!==completed.indexOf(n))return console.log("already completed this quiz!"),!1;completed.push(n)}$.ajax({url:e,type:"POST",data:{action:"waz_qc_activity",nonce:i,quiz_id:n,type:s}}).done(function(e){console.log(e)})}function addResult(e,i,n,s){return-1!==results.indexOf(n)?(console.log("already stored results for this quiz!"),!1):(results.push(n),void $.ajax({url:e,type:"POST",data:{action:"waz_qc_add_result",nonce:i,quiz_id:n,result:s}}).done(function(e){console.log(e)}))}function addResponse(e,i,n,s,t){$.ajax({url:e,type:"POST",data:{action:"waz_qc_add_response",nonce:i,quiz_id:n,question:s,response:t}}).done(function(e){console.log(e)})}function sendResponses(e,i){var n="",s="";e.hasOwnProperty("user")&&(n=e.user.name,s=e.user.email),$.ajax({url:e.ajaxurl,type:"POST",data:{action:"waz_qc_send_responses",nonce:e.nonce,quiz_id:e.quiz_id,name:n,email:s,result:i,responses:e.responses}}).done(function(e){console.log(e)})}function restartQuiz(){location.reload()}function showSharingAndResultScreen(e,i){sendResponses(e,i),$(e.selector).find(".waz_qc_score_container").show(),"on"==e.quiz_settings.restart_button&&$("#waz_qc_restart_button").click(function(){restartQuiz(e),$(this).hide()}).show("fast"),"end"==e.showAnswersAt&&showResponses(e),"on"==e.quiz_settings.show_sharing&&showSharing(e,i)}function getCorrectAnswerHtml(e){var i="",n="";return $(e.selector).find(".waz_qc_answer_div").each(function(){$(this).attr("data-question")==e.currentAnswer&&(i=addQuizImg($(this).find(".waz_qc_quiz_answer_img").attr("src")),n=$(this).find(".waz_qc_answer_span").html().replace(svgSquare,""))}),i+n}function showSharing(e,i){$(e.selector).find(".waz_qc_social_share").show("fast");var n=$(e.selector).find(".waz_qc_score_img").attr("src");""===n&&(n=$(e.selector).find(".waz_qc_quiz_description_img").attr("src")),""===n&&(n=defaultImg);var s=$(e.selector).find("#waz_qc_share_link_facebook");1==s.length&&s.prop("href",buildFacebookShareUrl(e,n,i));var t=$(e.selector).find("#waz_qc_share_link_twitter");1==t.length&&encodeShareString(e,t,i);var r=$(e.selector).find("#waz_qc_share_link_email");1==r.length&&r.prop("href",buildEmailShareUrl(e,i));var a=$(e.selector).find("#waz_qc_share_link_whatsapp");1==a.length&&encodeShareString(e,a,i);var o=$(e.selector).find("#waz_qc_share_link_pinterest");1==o.length&&(encodeShareString(e,o,i),o.prop("href",o.prop("href")+"&media="+n)),$(e.selector).find(".waz_qc_share_link").click(function(i){i.preventDefault();var n=$(this).prop("href");window.open(n,"_blank","resizable=yes,scrollbars=yes,titlebar=yes, width=560, height=443, top=100, left=50"),addActivity(e.ajaxurl,e.nonce,e.quiz_id,"shares")})}function encodeShareString(e,i,n){var s=encodeURIComponent(e.sharestring.replace("{{MY_QUIZ_RESULT}}",n)),t=i.prop("href");i.prop("href",t+s)}function buildFacebookShareUrl(e,i,n){return"https://www.facebook.com/dialog/feed?app_id="+e.facebook_app_id+"&link="+encodeURIComponent(e.shareurl)+"&name="+encodeURIComponent(e.sharename)+"&caption="+encodeURIComponent(e.sharecaption.replace("{{MY_QUIZ_RESULT}}",n))+"&description="+encodeURIComponent(e.sharestring.replace("{{MY_QUIZ_RESULT}}",n))+"&picture="+i}function buildEmailShareUrl(e,i){return"mailto:?body="+encodeURIComponent(e.sharename+" "+e.shareurl)+"&subject="+encodeURIComponent(e.sharestring.replace("{{MY_QUIZ_RESULT}}",i))}function addQuizImg(e){return e&&""!==e&&"string"==typeof e?"<img class='waz_qc_quiz_answer_img' src='"+e+"'>":""}function scrollIntoView(e){var i=$(e).offset().top;0>i&&(i=0),$("html, body").animate({scrollTop:i},300)}function debounce(e,i,n){var s;return function(){var t=this,r=arguments,a=function(){s=null,n||e.apply(t,r)},o=n&&!s;clearTimeout(s),s=setTimeout(a,i),o&&e.apply(t,r)}}function shuffleArray(e){for(var i=e.length-1;i>0;i--){var n=Math.floor(Math.random()*(i+1)),s=e[i];e[i]=e[n],e[n]=s}return e}var usingIE=detectIE(),scoreString=$(".waz_qc_score_text").first().html(),svgSquare='<svg class="waz_qc_rectancle" width="26" height="26"><rect width="26" height="26" style="fill:#fff;stroke-width:1;stroke:#000;"></rect></svg>',quizzes={},defaultImg="";loadQuizzes(),preloadImages(),$(".waz_qc_start_button").click(function(){var e=quizzes[getQuizId($(this).closest(".waz_qc_quiz"))];addActivity(e.ajaxurl,e.nonce,e.quiz_id,"starts"),usingIE&&ieFix(e.selector),e.questionCurrentIndex=0,e.score=0,e.responses=[],e.questionCount=e.questions.length,e.showAnswersAt=""===e.quiz_settings.hide_answers?"after":"on"===e.quiz_settings.hide_answers?"end":e.quiz_settings.hide_answers,$(this).siblings(".waz_qc_quiz_title").hide(),$(this).siblings(".waz_qc_quiz_description").hide(),$(this).siblings(".waz_qc_quiz_description_img").hide(),$(this).hide(),$(this).siblings(".waz_qc_quiz_div").show(),$(this).siblings(".waz_qc_quiz_footer").show(),$(this).siblings(".flip-container").show(),$(this).siblings(".waz_qc_question_count").html("1/"+e.questionCount),showQuestion(e),scrollIntoView(e.selector)}),$(".waz_qc_next_question").click(function(){var e=quizzes[getQuizId($(this).closest(".waz_qc_quiz"))];usingIE?($(e.selector).find("#waz_qc_answer_container").show(),$(e.selector).find("#waz_qc_back_container").hide()):$(e.selector).find(".waz_qc_quiz_div").removeClass("flip"),showQuestion(e)}),$(".waz_qc_answer_div").click(function(){var e=quizzes[getQuizId($(this).closest(".waz_qc_quiz"))];scrollIntoView(e.selector),$(this).blur();var i=!1;$(this).attr("data-question")===e.currentAnswer&&(e.score=e.score+1,i=!0);var n={answer:addQuizImg($(this).children(".waz_qc_quiz_answer_img").attr("src"))+$(this).children(".waz_qc_answer_span").html().replace(svgSquare,""),isCorrect:i,correctAnswer:getCorrectAnswerHtml(e),question:$(this).siblings("#waz_qc_question").html()};if(e.responses.push(n),addResponse(e.ajaxurl,e.nonce,e.quiz_id,n.question,n.answer),"pt"==e.quiz_settings.quiz_type)$.each($(this).data("results"),function(i,n){$.each(e.quiz_results,function(e,i){if(n==i.id)return i.score=i.hasOwnProperty("score")?i.score+1:1,!0})}),showQuestion(e);else if("after"==e.showAnswersAt){$(e.selector).find("#waz_qc_your_answer").html(addQuizImg($(this).children(".waz_qc_quiz_answer_img").attr("src"))+$(this).children(".waz_qc_answer_span").html().replace(svgSquare,""));var s=getCorrectAnswerHtml(e);$(e.selector).find("#waz_qc_correct_answer").html(s),usingIE?($(e.selector).find("#waz_qc_answer_container").hide(),$(e.selector).find("#waz_qc_back_container").show()):$(e.selector).find(".waz_qc_quiz_div").addClass("flip"),$(e.selector).find("#waz_qc_back_container").removeClass("correct-answer"),$(e.selector).find("#waz_qc_back_container").removeClass("wrong-answer"),i?($(e.selector).find("#waz_qc_back_container").addClass("correct-answer"),$(e.selector).find("#waz_qc_question_right_or_wrong").html(e.correct_string),$(e.selector).find("#waz_qc_correct_answer_p").hide()):($(e.selector).find("#waz_qc_back_container").addClass("wrong-answer"),$(e.selector).find("#waz_qc_question_right_or_wrong").html(e.wrong_string),$(e.selector).find("#waz_qc_correct_answer_p").show()),scaleFlipBoxBack(e.selector)}else showQuestion(e)});var optins=[],shared=[],completed=[],results=[],resizeWindow=debounce(function(){jQuery.each(quizzes,function(e){$(quizzes[e].selector).find("#waz_qc_answer_container").waitForImages(function(){maybeAddQuarterClass(quizzes[e].selector),scaleFlipBoxQuestion(quizzes[e].selector)})})},50);window.addEventListener("resize",resizeWindow)});